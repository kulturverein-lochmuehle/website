---
import '@kvlm/ui/global.css';

import { getCollection } from 'astro:content';
import { isInlineSection } from '@utils/astro.utils';
import { Main, Navigation, NavigationItem }Â from '@components/ui.components';

const collection = await getCollection('verein');
const sections = collection.filter(({ id }) => isInlineSection(id));
const pages = collection.filter(({ id }) => !isInlineSection(id));

const { lang = 'en', title } = Astro.props;
const { slug: currentSlug } = Astro.params;
const { pathname } = Astro.url;
const basePath = pathname.replace(new RegExp(`/${currentSlug}$`), '');
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta content="IE=Edge" http-equiv="x-ua-compatible" />

    <title>{title}</title>
  </head>
  <body>
    <header>
      <Navigation>
        {
          sections
            .concat(pages)
            .map(({ data, id, slug }) => (
              <NavigationItem
                inline={isInlineSection(id)}
                active={slug === currentSlug}
                href={`${basePath}/${slug}`}
                label={data.title}
              ></NavigationItem>
            )) as any
        }
      </Navigation>
    </header>
    <main>
      <Main client:idle scrollObserveSelector="kvlm-section">
        <slot />
      </Main>
    </main>
  </body>
</html>
